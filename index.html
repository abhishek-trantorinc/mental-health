<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GHQ-12 Self-Check</title>
    <style>
        :root{--fg:#0f172a;--muted:#475569;--bg:#f8fafc;--card:#ffffff;--accent:#0ea5e9;--ok:#16a34a;--warn:#dc2626}
        html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans','Helvetica Neue',Arial}
        .container{max-width:900px;margin:2rem auto;padding:0 1rem}
        .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 2px 10px rgba(2,6,23,.04);padding:1.25rem}
        h1{font-size:1.6rem;margin:.25rem 0 0}
        .sub{color:var(--muted);margin:.25rem 0 1rem}
        fieldset{border:0;margin:0 0 1rem;padding:0}
        legend{font-weight:600;margin:1rem 0 .5rem}
        .q{padding:.75rem 1rem;border-radius:12px;border:1px solid #e5e7eb;margin-bottom:.75rem;background:#fff}
        .q-title{font-weight:600;margin-bottom:.5rem}
        .opts{display:grid;grid-template-columns:repeat(2,minmax(200px,1fr));gap:.25rem .75rem}
        label{display:flex;align-items:center;gap:.5rem;cursor:pointer}
        input[type=radio]{transform:scale(1.1)}
        .controls{display:flex;flex-wrap:wrap;gap:.5rem;margin:.75rem 0 1rem}
        select,button{appearance:none;border:1px solid #e5e7eb;background:#fff;color:var(--fg);padding:.5rem .75rem;border-radius:10px}
        button{cursor:pointer}
        button.primary{background:var(--accent);border-color:var(--accent);color:#fff}
        button:disabled{opacity:.6;cursor:not-allowed}
        .result{margin-top:1rem;padding:1rem;border-radius:12px;border:1px dashed #cbd5e1;background:#f1f5f9}
        .pill{display:inline-block;border-radius:999px;padding:.25rem .6rem;font-weight:600}
        .pill.ok{background:rgba(22,163,74,.1);color:var(--ok)}
        .pill.warn{background:rgba(220,38,38,.1);color:var(--warn)}
        table{width:100%;border-collapse:collapse;margin-top:.5rem}
        th,td{border-bottom:1px solid #e5e7eb;padding:.5rem;text-align:left;font-size:.95rem}
        .footer{color:var(--muted);font-size:.875rem;margin-top:1rem}
        details.bt{margin:.5rem 0;padding:.6rem .8rem;border:1px dashed #e2e8f0;border-radius:12px;background:#fff}
        details.bt summary{cursor:pointer;font-weight:600}
        code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:#f8fafc;padding:.1rem .3rem;border-radius:6px}
        @media (max-width:640px){.opts{grid-template-columns:1fr}}
    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <h1>Short General Health Questionnaire (GHQ-12)</h1>
        <p>This is a screening tool, not a diagnostic test.</p>
        <p class="sub">Select one option for each item that best describes how you have felt <strong>from 4 weeks</strong>. Your total and per-item scores are shown after you submit.</p>

       <!-- <details class="bt">
            <summary>Scoring reference (Likert 0-1-2-3)</summary>
            <p><strong>Positively worded items</strong> (1, 3, 4, 7, 8, 12):<br>
                Better than usual → <code>0</code> · Same as usual → <code>1</code> · Less than usual → <code>2</code> · Much less than usual → <code>3</code></p>
            <p><strong>Negatively worded items</strong> (2, 5, 6, 9, 10, 11):<br>
                Not at all → <code>0</code> · No more than usual → <code>1</code> · Rather more than usual → <code>2</code> · Much more than usual → <code>3</code></p>
        </details>

        <div class="controls">
            <label>Scoring method:
                <select id="mode">
                    <option value="likert" selected>Likert 0-1-2-3</option>
                    <option value="binary">GHQ (0-0-1-1)</option>
                </select>
            </label>
        </div>-->

        <form id="ghqForm">
            <div id="questions"></div>
            <div class="controls">
                <button type="submit" class="primary">Calculate score</button>
                <button type="button" id="resetBtn">Reset</button>
              <!--  <button type="button" id="exportCsvBtn" title="Download a CSV of your answers">Export CSV</button>
                <button type="button" id="exportJsonBtn" title="Copy JSON of your answers">Copy JSON</button>
              -->  <button type="button" id="printBtn" title="Print or save as PDF">Print</button>
            </div>
        </form>

        <div id="result" class="result" hidden>
            <div><strong>Total score:</strong> <span id="total"></span></div>
            <div style="margin:.25rem 0 .5rem">
                <span id="tag" class="pill"></span>
            </div>
            <details open>
                <summary><strong>Per-item scores</strong></summary>
                <table id="breakdown">
                    <thead><tr><th>Item</th><th>Response</th><th>Score</th></tr></thead>
                    <tbody></tbody>
                </table>
            </details>
            <p class="footer">Default is <strong>Likert 0-1-2-3</strong> as per your reference. Toggle to <strong>GHQ 0-0-1-1</strong> if you prefer the binary method. No clinical cut-offs are enforced here.</p>
        </div>
    </div>
</div>

<script>
    (function(){
        // --- Items and choice sets ---
        const POS = new Set([1,3,4,7,8,12]);
        const NEG = new Set([2,5,6,9,10,11]);
        const POS_CHOICES = ['Better than usual','Same as usual','Less than usual','Much less than usual'];
        const NEG_CHOICES = ['Not at all','No more than usual','Rather more than usual','Much more than usual'];

        const ITEMS = [
            [1, "Been able to concentrate on what you’re doing?"],
            [2, "Lost much sleep over worry?"],
            [3, "Felt you were playing a useful part in things?"],
            [4, "Felt capable of making decisions about things?"],
            [5, "Felt constantly under strain?"],
            [6, "Felt you couldn’t overcome your difficulties?"],
            [7, "Been able to enjoy your normal day-to-day activities?"],
            [8, "Been able to face up to your problems?"],
            [9, "Been feeling unhappy and depressed?"],
            [10, "Been losing confidence in yourself?"],
            [11, "Been thinking of yourself as a worthless person?"],
            [12, "Been feeling reasonably happy, all things considered?"],
        ];

        // Scoring maps (strictly per your image)
        const POS_SCORE = { 'Better than usual':0, 'Same as usual':1, 'Less than usual':2, 'Much less than usual':3, 'About same as usual':1 };
        const NEG_SCORE = { 'Not at all':0, 'No more than usual':1, 'Rather more than usual':2, 'Much more than usual':3 };

        // Binary GHQ (0-0-1-1). Index order of choices is already low→high for both sets.
        const BIN_MAP = [0,0,1,1];

        // --- Render ---
        const $qs = document.getElementById('questions');
        ITEMS.forEach(([n, text]) => {
            const fs = document.createElement('fieldset');
            fs.className = 'q';
            const legend = document.createElement('div');
            legend.className = 'q-title';
            legend.textContent = `Q${n}. ${text}`;
            fs.appendChild(legend);

            const opts = document.createElement('div');
            opts.className = 'opts';
            const name = `q${n}`;
            const list = POS.has(n) ? POS_CHOICES : NEG_CHOICES;

            list.forEach((labelText) => {
                const lbl = document.createElement('label');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = name; input.required = true; input.value = labelText;
                input.setAttribute('aria-label', labelText);
                const span = document.createElement('span');
                span.textContent = labelText;
                lbl.appendChild(input); lbl.appendChild(span);
                opts.appendChild(lbl);
            });

            fs.appendChild(opts);
            $qs.appendChild(fs);
        });

        // --- Handlers ---
        const form = document.getElementById('ghqForm');
        const modeSel = document.getElementById('mode');
        const result = document.getElementById('result');
        const totalEl = document.getElementById('total');
        const tagEl = document.getElementById('tag');
        const tbody = document.querySelector('#breakdown tbody');

        form.addEventListener('submit', (e) => {
            e.preventDefault();

            const mode = modeSel.value; // 'likert' | 'binary'
            tbody.innerHTML = '';

            let total = 0;

            // Collect answers and compute per-item scores
            for (const [n] of ITEMS) {
                const sel = form.querySelector(`input[name=q${n}]:checked`);
                if (!sel) {
                    alert('Please answer all questions.');
                    return;
                }

                const ans = sel.value;

                // Score this item
                let s;
                if (mode === 'likert') {
                    s = POS.has(n) ? POS_SCORE[ans] : NEG_SCORE[ans];
                } else {
                    // Binary GHQ (0-0-1-1) based on option index
                    const list = POS.has(n) ? POS_CHOICES : NEG_CHOICES;
                    const idx = list.indexOf(ans);
                    s = idx >= 0 ? BIN_MAP[idx] : null;
                }

                if (typeof s === 'number') total += s;

                // Row in the breakdown table
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>Q${n}</td><td>${escapeHtml(ans)}</td><td>${s}</td>`;
                tbody.appendChild(tr);
            }

            // Totals and interpretation
            const max = mode === 'likert' ? 36 : 12;
            totalEl.textContent = `${total} / ${max}`;

            if (mode === 'likert') {
                // Likert interpretation (your ranges)
                let msg = '';
                let cls = 'pill';

                if (total <= 11) {
                    msg = 'Within normal range. No significant distress. Encourage healthy coping habits.';
                    cls = 'pill ok';
                } else if (total <= 15) {
                    msg = 'Mild distress. Early warning signs; consider stress management and self-care.';
                    cls = 'pill warn';
                } else if (total <= 20) {
                    msg = 'Moderate distress. Difficulty coping; further evaluation recommended.';
                    cls = 'pill warn';
                } else {
                    msg = 'Severe distress. May require urgent specialist help.';
                    cls = 'pill warn';
                }

                tagEl.textContent = msg;
                tagEl.className = cls;
            } else {
                // Binary method – simple tag (no clinical cut-offs enforced here)
                const ok = total <= 3; // adjust if you prefer a different flag
                tagEl.textContent = ok
                    ? 'Lower score (binary method)'
                    : 'Higher score (binary method)';
                tagEl.className = 'pill ' + (ok ? 'ok' : 'warn');
            }

            result.hidden = false;
            window.scrollTo({ top: result.offsetTop - 20, behavior: 'smooth' });
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            form.reset();
            result.hidden = true; tbody.innerHTML = '';
        });

        document.getElementById('printBtn').addEventListener('click', () => window.print());

        document.getElementById('exportCsvBtn').addEventListener('click', () => {
            const mode = modeSel.value;
            const rows = [['Item','Response','Score','Method', mode]];
            let total = 0;
            for (const [n] of ITEMS) {
                const sel = form.querySelector(`input[name=q${n}]:checked`);
                const ans = sel ? sel.value : '';
                let s = '';
                if (sel) {
                    if (mode === 'likert') s = POS.has(n) ? POS_SCORE[ans] : NEG_SCORE[ans];
                    else {
                        const list = POS.has(n) ? POS_CHOICES : NEG_CHOICES;
                        const idx = list.indexOf(ans); s = idx >= 0 ? BIN_MAP[idx] : '';
                    }
                    if (typeof s === 'number') total += s;
                }
                rows.push([`Q${n}`, ans, s]);
            }
            rows.push(['Total','',''+total]);
            const csv = rows.map(r=>r.map(csvEscape).join(',')).join('\\n');
            download('ghq12_responses.csv', new Blob([csv], {type:'text/csv'}));
        });

        document.getElementById('exportJsonBtn').addEventListener('click', async () => {
            const mode = modeSel.value;
            const out = { mode, total:0, items:{} };
            for (const [n] of ITEMS) {
                const sel = form.querySelector(`input[name=q${n}]:checked`);
                if (!sel) continue;
                const ans = sel.value;
                let s;
                if (mode === 'likert') s = POS.has(n) ? POS_SCORE[ans] : NEG_SCORE[ans];
                else {
                    const list = POS.has(n) ? POS_CHOICES : NEG_CHOICES;
                    const idx = list.indexOf(ans); s = idx >= 0 ? BIN_MAP[idx] : null;
                }
                out.items[`Q${n}`] = { response: ans, score: s };
                if (typeof s === 'number') out.total += s;
            }
            const text = JSON.stringify(out, null, 2);
            try { await navigator.clipboard.writeText(text); } catch(e) {}
            download('ghq12_result.json', new Blob([text], {type:'application/json'}));
            alert('JSON copied to clipboard and downloaded.');
        });

        // --- utils ---
        function download(filename, blob){
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob); a.download = filename; a.click();
            setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
        }
        function csvEscape(s){
            s = String(s ?? '');
            return /[\",\\n]/.test(s) ? '\"'+s.replace(/\"/g,'\"\"')+'\"' : s;
        }
        function escapeHtml(s){
            return String(s).replace(/[&<>\"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
        }
    })();
</script>
</body>
</html>